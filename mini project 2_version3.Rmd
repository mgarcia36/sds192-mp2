---
title: "Mini Project 2"
author: "Diana Fierros-Pina, Karen Diaz, Marta Garcia"
date: "March 20, 2017"
output: html_document
---

```{r, message=FALSE}
require(tidyverse)
require(ggthemes)
require(plyr)
require(lubridate)
```


```{r, include=FALSE}
#load("house_elections.rda")
#load("candidates.rda")
#load("contributions.rda")

load("committees.rda")
load("individuals.rda")

```

```{r, message=FALSE, warning=FALSE}
#The following function will make the new data frame "contributions_by_state"
#The function will allow user to input state abbreviation, or "state_arg" to get top 10 committees that individuals within state have donated to
#mutate()
#filter()
#inner_join()
#select()
#group_by()
#summarise()
#arrange()

require(lubridate)
contributions_by_state <- function(state_arg){
  individuals %>%
  mutate(transaction_date = mdy(transaction_dt)) %>%
  filter(state == state_arg, 
         entity_type == "IND",
         transaction_date >= "2011-01-01",
         transaction_date <= "2011-12-31",
         transaction_amt >= 0 & transaction_amt <= 5000) %>%
  inner_join(committees, by = "cmte_id") %>%
  select(transaction_type, 
         entity_type, 
         state, 
         transaction_date, 
         transaction_amt,
         cmte_name)%>%
    group_by(cmte_name) %>%
    summarise(com_groups = sum(transaction_amt)) %>%
    arrange(desc(com_groups)) 
    
}

```

```{r, message=FALSE, warning=FALSE}

#The following will make up the new data frame "contributions_by_all"
#mutate() mutates variable "transaction_dt" from individuals data frame to new variable transaction date, so it is a 'date' type
#filter() filters rows that have the desired state, entity_type, transaction_date and transaction_amt
#inner_join to join individuals and committees data frames by column "cmte_id"
#select() selects specific columns from data frame that we're interested in
contributions_by_all <- individuals %>%
  mutate(transaction_date = mdy(transaction_dt)) %>%
  filter(state == "NY", 
         entity_type == "PAC",
         transaction_date >= "2011-01-01",
         transaction_date <= "2011-12-31",
         transaction_amt >= 0 & transaction_amt <= 5000) %>%
  inner_join(committees, by = "cmte_id") %>%
  select(transaction_type, 
         entity_type, 
         state, 
         transaction_date, 
         transaction_amt,
         cmte_name,
         cmte_id)%>%
  group_by(cmte_name) %>%
  summarise(com_groups = sum(transaction_amt)) %>%
  arrange(desc(com_groups)) 
  
```

#-------------------------------------------
### Red State in 2011: Alaska (Diana)
```{r, message=FALSE, warning=FALSE}
# The following will make up the new data frame "contributions_by_alaska"
# mutate() mutates variable "transaction_dt" from individuals data frame to new variable transaction date, so it is a 'date' type
# filter() filters rows that have the desired state, entity_type, transaction_date and transaction_amt
# inner_join to join individuals and committees data frames by column "cmte_id"
# select() selects specific columns from data frame that we're interested in

require(lubridate)
contributions_by_alaska <- individuals %>%
  mutate(transaction_date = mdy(transaction_dt)) %>%
  filter(state == "AK", 
         entity_type == "IND",
         transaction_date >= "2011-01-01",
         transaction_date <= "2011-12-31",
         transaction_amt >= 0 & transaction_amt <= 5000) %>%
  inner_join(committees, by = "cmte_id") %>%
  select(transaction_type, 
         entity_type, 
         state, 
         transaction_date, 
         transaction_amt,
         cmte_name,
         cmte_id)

tallying_alaska <- contributions_by_alaska %>%
  group_by(cmte_name) %>%
  tally(sort = TRUE)
```


### +1 for explaining in a single coherent sentence what we can learn from these data
The main idea of this bar chart, is to capture the top ten committees and the amount received (by each) from donations made by individuals in the state of Alaska during the 2011 federal election cycle. 

During the 2011 federal election cycle, these were the top ten committees and the amount of money received, by each respectively, from donations made by individuals in the state of Alaska.
```{r, fig.width = 15, fig.height = 10}

# Using ggplot to generate bar plot of the "Top Ten Committees Donated to by Individuals in 2011"

top_ten_cmte_alaska <- subset(contributions_by_alaska, cmte_name %in% tallying_alaska$cmte_name[0:10])

ggplot(top_ten_cmte_alaska, aes(cmte_name, transaction_amt)) +
  ggtitle("Committees that Received Contributions Made By Individuals in 2011") +
  geom_bar(stat = "identity", fill = "olivedrab") +
  theme_hc() +
  theme(axis.text.x = element_text(color = "black", 
                           size = 14, family = "Trebuchet MS", angle = 90, face = "bold"),
        axis.text.y = element_text(color = "black", 
                           size = 14, family = "Trebuchet MS", face = "bold"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(lineheight = 1, face="bold")) + 
  # Committees x- axis
  scale_x_discrete(name = "Recipients of Contributions",
                     expand = c(0,0),
                     labels = c("ACTBLUE" = "ACTBLUE",
                                "ALASKA DEMOCRATIC PARTY" = "AK DEM. PARTY",
                                "ALASKANS FOR BEGICH 2014" = "AK FOR BEGICH '14",
                                "ALASKANS FOR DON YOUNG INC." = "AK FOR DON YOUNG INC.",
                                "DNC SERVICES CORPORATION/DEMOCRATIC NATIONAL COMMITTEE" = "DNC",
                                "NATIONAL ASSOCIATION OF REALTORS POLITICAL ACTION COMMITTEE" = "NAT. ASSOC. OF REALTORS",
                                "OBAMA FOR AMERICA" = "OBAMA FOR AMERICA",
                                "REPUBLICAN NATIONAL COMMITTEE" = "RNC",
                                "ROMNEY FOR PRESIDENT INC." = "ROMNEY FOR PRESIDENT",
                                "RON PAUL 2012 PRESIDENTIAL CAMPAIGN COMMITTEE INC." = "RON PAUL '12 PRES. CAMPAIGN"
                                 )) +
  # Contribution Amount y-axis
  scale_y_continuous(name = "Total Amt. of Contributions",
                     labels = c("0" = "$0",
                              "25000" = "$25k",
                              "50000" = "$50k",
                              "75000" = "$75k",
                              "100000" = "$100k")) 



```


### +1 blog post text provides context or background useful in interpreting the graphic

The data visualization previously presented is a bar plot regarding the contributions made in the state of Alaska in the year 2011. Each bar represents one committee and the height of the bar represents the $ amount of all the contributions made by individuals. 
The key of this visualization is to allow the user to explore the different committees. 
The committees included are: Actblue, Alaska Democratic Party, Alaskans for Begich 2014, Alaskans for Don Young Inc., DNC (DNC Services Corporation/Democratic National Committee), Nat. Assoc. of Realtors (National Association of Realtors Political Action Committee), Obama for America, RNC (Republican National Committee), and Romney for President Inc., Ron Paul '12 Pres. Campaign.

It's important to not that even though Alaska is a republican state 4 out of 10 of the committees (in this visualization) are Democrats, which are the Alaskan Democratic Party, Alaskans for Begich 2014, DNC and Obama for America. Although Actblue is independent of the Democratic Party itself and does not endorse individual candidates, this committee enables anyone to raise money on the Internet for the Democratic Party candidates of their choice. One of the committees is libertarian which is the committee named Ron Paul '12 Presidential Campaign. 

So, even though Alaska is a republican state, there is a divide in idealogies throughout Alaskans in where they wish their contributions should go to.


#-------------------------------------------



#-------------------------------------------
### Swing State in 2011: Florida (Marta)
```{r, message=FALSE, warning=FALSE}
contributions_by_florida <- contributions_by_state(state_arg = "FL")

```


#-------------------------------------------
<<<<<<< HEAD
=======
### Blue State in 2011: California (Karen)
```{r, message=FALSE, warning=FALSE}
# The following will make up the new data frame "contributions_by_alaska"
# mutate() mutates variable "transaction_dt" from individuals data frame to new variable transaction date, so it is a 'date' type
# filter() filters rows that have the desired state, entity_type, transaction_date and transaction_amt
# inner_join to join individuals and committees data frames by column "cmte_id"
# select() selects specific columns from data frame that we're interested in


contributions_by_cali <- individuals %>%
  mutate(transaction_date = mdy(transaction_dt)) %>%
  filter(state == "CA", 
         entity_type == "IND",
         transaction_date >= "2011-01-01",
         transaction_date <= "2011-12-31",
         transaction_amt >= 0 & transaction_amt <= 5000) %>%
  inner_join(committees, by = "cmte_id") %>%
  select(transaction_type, 
         entity_type, 
         state, 
         transaction_date, 
         transaction_amt,
         cmte_name,
         cmte_id)

tallying_cali <- contributions_by_cali %>%
  group_by(cmte_name) %>%
  tally(sort = TRUE)

contributions_by_cali
tallying_cali
```



```{r, fig.width = 15, fig.height = 10}

# Using ggplot to generate bar plot of the "Top Ten Committees Donated to by Individuals in 2011 (California)"

top_ten_cmte_cali <- subset(contributions_by_cali, cmte_name %in% tallying_cali$cmte_name[0:10])

ggplot(top_ten_cmte_cali, aes(cmte_name, transaction_amt)) +
  ggtitle("Committees that Received Contributions Made By Individuals in 2011") +
  geom_bar(stat = "identity", fill = "blue") +
  theme_hc() +
  theme(axis.text.x = element_text(color = "black", 
                           size = 14, family = "Trebuchet MS", angle = 90, face = "bold"),
        axis.text.y = element_text(color = "black", 
                           size = 14, family = "Trebuchet MS", face = "bold"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        plot.title = element_text(lineheight = 1, face="bold")) + 
  # Committees x- axis
  scale_x_discrete(name = "Recipients of Contributions",
                     expand = c(0,0),
                     labels = c("ACTBLUE" = "ACTBLUE",
                                "DNC SERVICES CORPORATION/DEMOCRATIC NATIONAL COMMITTEE" = "DNC",
                                "DEMOCRATIC SENATORIAL CAMPAIGN COMMITTEE" = "DEMOCRATIC SENATORIAL CAMPAIGN COMMITTEE",
                                "DEMOCRATIC CONGRESSIONAL CAMPAIGN COMMITTEE" = "DEMOCRATIC CONGRESSIONAL CAMPAIGN COMMITTEE",
                                "EMILY'S LIST" = "EMILY'S LIST",
                                "OBAMA FOR AMERICA" = "OBAMA FOR AMERICA",
                                "OBAMA VICTORY FUND 2012" = "OBAMA VICTORY FUND 2012",
                                "REPUBLICAN NATIONAL COMMITTEE" = "RNC",
                                "ROMNEY FOR PRESIDENT INC." = "ROMNEY FOR PRESIDENT",
                                "RON PAUL 2012 PRESIDENTIAL CAMPAIGN COMMITTEE INC." = "RON PAUL '12 PRES. CAMPAIGN"
                                 )) +
  # Contribution Amount y-axis
  scale_y_continuous(name = "Total Amt. of Contributions",
                     labels = c("0" = "$0",
                              "25000" = "$25k",
                              "50000" = "$50k",
                              "75000" = "$75k",
                              "100000" = "$100k")) + coord_flip()

                                      



```


### +1 blog post text provides context or background useful in interpreting the graphic

The second data visualization presented is a bar plot regarding the contributions made in the state of California in the year 2011.The difference here, is that California is historically known for being a blue state during election cycles in comparison to Alaska. 
 
The committees included are: Actblue, Democratic Congressional Campaign Committee, Democratic Senatorial Campaign Committee, Democratic Congressional Campaign Committee, DNC (DNC Services Corporation/Democratic National Committee), Emily's List, Obama Victory Fund 2012, Obama for America, RNC (Republican National Committee), Romney for President Inc., Ron Paul '12 Pres. Campaign.

Here, we see a strong alingment to democratic ideology as 7 of the top ten committees that received contributions from individuals are Democrat. However, it is important to note that although a liberal idealogy is most common, there is still a  Republican presence shown through the Romney for President campaign, which received an almost equal amount of contributions as the Obama for America committee. There is also a Libretarian presence represented through the Ron Paul '12 Pres. Campaign. So, we can say there are a variety of political ideologies represented. Another important thing to note is that there are more contributions being made to presidential campaigns than those for the RNC, DNC, Democratic Senatorial Campaign Committee, etc. In this case, it is most important to individuals in Califonia to make monetary contributions to the face of America, the president, than it is to make contributions to other political branches such as the senate, congress, etc. This is interesting because typically, these branches of the government have the most say in regards to legislation and health care, the federal budget, etc. One last interesting point to make is the ammount of support directly made to the Obama campaign in this state, which demonstates the preferred presidential candidate. Howver, one unique entity is Emily's List, which works towards igniting change by getting pro-choice Democratic women elected to office. The ammount of contributions made to this commitee also signifies a strong pro-women, pro-choice ideology present in the state.


### +1 for explaining in a single coherent sentence what we can learn from these data
The main idea of this bar chart, is to capture the top ten committees and the amount received (by each) from donations made by individuals in 3 specific states during the 2011 federal election cycle. 


#-------------------------------------------







>>>>>>> 8e1bd2afde7f78d7e75c49ad969aae89ab5fa7ba
```{r}
#FUNCTION USED + UPDATES------------------------------------------------
contributions_new <- function(data, state_arg, entity_type_arg){
  new_data <- data %>%
    mutate(transaction_date = mdy(transaction_dt)) %>%
    filter(state == state_arg,
           entity_type == entity_type_arg,
           transaction_date >= "2011-01-01" & transaction_date <= "2011-12-31",
           transaction_amt >= 0 & transaction_amt <= 5000) %>%
    select(transaction_date,
           state,
           entity_type,
           transaction_type,
           transaction_amt)
    return(new_data)
  }

#contributions_new(data = contributions, state_arg = "CA", entity_type_arg = "PAC")
entity_data <- contributions_new(data = contributions, state_arg = "CA", entity_type_arg = "PAC")
glimpse(entity_data)

#finds fthe frequency of each transaction type
most_common <- as.data.frame(table(unlist(entity_data$transaction_type)))
class(most_common)
#order(most_common$Freq)

#dorts in descending order
most_common[order(most_common$Freq, decreasing = TRUE), ]
#glimpse(most_common)
#-----------------------------------------------------------------------
```


#+1 for explaining in a single coherent sentence what we can learn from these data
#The main idea of this is to capture the most common monetary ammount crontributed to the 2011-2012 federal election cycle by political entities.



#+1 blog post text provides context or background useful in interpreting the graphic
#The following code creates a data visualization in the form of a histogram regarding contributions to the federal election cycle of 2011-2012. Here, the histogram presents 11 bins ranging from $0 of monetary contributions to $5000. The key of this visualization is to allow the user to explore the number of different values of the contributions made by political entities. The different political entities include contributions made by a candidate, a candidate committee, committee, individual, organization, politial action committee or a party organization. One example can be to explore the different number of contributions made by CCM's, or candidate commitees, where contributions of about $1000 were the most common. The data used in the visualization stems from the Federal Election Committee (FEC), whose statute limits the sources and amounts of the contributions used to finance federal elections and requires public disclosure of campaign finance information. This type of analysis is useful in helping regulate and predict what values are expected/common from a specific entity. This can assist if there is an unprecedented or extreme dip or spike in the average monetary contribution, where the FEC can then investigate if necessary.


## New Information--------------------------------------
A political action committee (PAC) is a type of organization that pools campaign contributions from members and donates those funds to campaign for or against candidates, ballot initiatives, or legislation.


Common transaction types

24K
Contribution made to nonaffiliated committee

24A
Independent expenditure opposing election of candidate

24Z
In-kind contribution made to registered filer
## ----------------------------------------------------

