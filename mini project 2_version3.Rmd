---
title: "Mini Project 2"
author: "Diana Fierros-Pina, Karen Diaz, Marta Garcia"
date: "March 20, 2017"
output: html_document
---

```{r, message=FALSE}
require(tidyverse)
require(ggthemes)
require(plyr)
require(lubridate)
```


```{r, include=FALSE}
#load("house_elections.rda")
#load("candidates.rda")
#load("contributions.rda")

load("committees.rda")
load("individuals.rda")



```



```{r}

#The following will make up the new data frame "contributions_by_all"
#mutate() mutates variable "transaction_dt" from individuals data frame to new variable transaction date, so it is a 'date' type
#filter() filters rows that have the desired state, entity_type, transaction_date and transaction_amt
#inner_join to join individuals and committees data frames by column "cmte_id"
#select() selects specific columns from data frame that we're interested in



contributions_by_all <- individuals %>%
  mutate(transaction_date = mdy(transaction_dt)) %>%
  filter(state == "NY", 
         entity_type == "PAC",
         transaction_date >= "2011-01-01",
         transaction_date <= "2011-12-31",
         transaction_amt >= 0 & transaction_amt <= 5000) %>%
  inner_join(committees, by = "cmte_id") %>%
  select(transaction_type, 
         entity_type, 
         state, 
         transaction_date, 
         transaction_amt,
         cmte_name,
         cmte_id) 
  
```



```{r}
ggplot(contributions_by_all, aes(cmte_name, transaction_amt)) +
  geom_bar(stat = "identity") 
```


### Red State in 2011: Alaska (Diana)
```{r}
#The following will make up the new data frame "contributions_by_alaska"
#mutate() mutates variable "transaction_dt" from individuals data frame to new variable transaction date, so it is a 'date' type
#filter() filters rows that have the desired state, entity_type, transaction_date and transaction_amt
#inner_join to join individuals and committees data frames by column "cmte_id"
#select() selects specific columns from data frame that we're interested in


contributions_by_alaska <- individuals %>%
  mutate(transaction_date = mdy(transaction_dt)) %>%
  filter(state == "AK", 
         entity_type == "IND",
         transaction_date >= "2011-01-01",
         transaction_date <= "2011-12-31",
         transaction_amt >= 0 & transaction_amt <= 5000) %>%
  inner_join(committees, by = "cmte_id") %>%
  select(transaction_type, 
         entity_type, 
         state, 
         transaction_date, 
         transaction_amt,
         cmte_name,
         cmte_id)

tallying_alaska <- contributions_by_alaska %>%
  group_by(cmte_name) %>%
  tally(sort = TRUE)
```


```{r}

top_ten_cmte_alaska <- subset(contributions_by_alaska, cmte_name %in% tallying_alaska$cmte_name[0:10])

ggplot(top_ten_cmte_alaska, aes(cmte_name, transaction_amt)) +
  ggtitle("Top Ten Committees Donated to by Individuals in 2011") +
  geom_bar(stat = "identity", fill = "olivedrab") +
  theme_hc() +
  theme(axis.text.x = element_text(color = "black", 
                           size = 10, family = "Trebuchet MS", angle = 90),
        axis.text.y = element_text(color = "black", 
                           size = 10, family = "Trebuchet MS"),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()
        ) + 
  # Committees x- axis
  scale_x_discrete(name = "Donation Amount",
                     expand = c(0,0),
                     labels = c("ACTBLUE" = "ACTBLUE",
                                "ALASKA DEMOCRATIC PARTY" = "AK DEM. PARTY",
                                "ALASKANS FOR BEGICH 2014" = "AK FOR BEGICH '14",
                                "ALASKANS FOR DON YOUNG INC." = "AK FOR DON YOUNG INC.",
                                "DNC SERVICES CORPORATION/DEMOCRATIC NATIONAL COMMITTEE" = "DNC",
                                "NATIONAL ASSOCIATION OF REALTORS POLITICAL ACTION COMMITTEE" = "NAT. ASSOC. OF REALTORS",
                                "OBAMA FOR AMERICA" = "OBAMA FOR AMERICA",
                                "REPUBLICAN NATIONAL COMMITTEE" = "RNC",
                                "ROMNEY FOR PRESIDENT INC." = "ROMNEY FOR PRESIDENT",
                                "RON PAUL 2012 PRESIDENTIAL CAMPAIGN COMMITTEE INC." = "RON PAUL '12 PRES. CAMPAIGN"
                                 )) +
  # Donation Amount y-axis
  scale_y_continuous(name = "Total Amt. of Donations",
                   labels = c("0" = "$0",
                              "25000" = "$25k",
                              "50000" = "$50k",
                              "75000" = "$75k",
                              "100000" = "$100k")) 



```

























```{r}
#FUNCTION USED + UPDATES------------------------------------------------
contributions_new <- function(data, state_arg, entity_type_arg){
  new_data <- data %>%
    mutate(transaction_date = mdy(transaction_dt)) %>%
    filter(state == state_arg,
           entity_type == entity_type_arg,
           transaction_date >= "2011-01-01" & transaction_date <= "2011-12-31",
           transaction_amt >= 0 & transaction_amt <= 5000) %>%
    select(transaction_date,
           state,
           entity_type,
           transaction_type,
           transaction_amt)
    return(new_data)
  }

#contributions_new(data = contributions, state_arg = "CA", entity_type_arg = "PAC")
entity_data <- contributions_new(data = contributions, state_arg = "CA", entity_type_arg = "PAC")
glimpse(entity_data)

#finds fthe frequency of each transaction type
most_common <- as.data.frame(table(unlist(entity_data$transaction_type)))
class(most_common)
#order(most_common$Freq)

#dorts in descending order
most_common[order(most_common$Freq, decreasing = TRUE), ]
#glimpse(most_common)
#-----------------------------------------------------------------------
```


#+1 for explaining in a single coherent sentence what we can learn from these data
#The main idea of this is to capture the most common monetary ammount crontributed to the 2011-2012 federal election cycle by political entities.



#+1 blog post text provides context or background useful in interpreting the graphic
#The following code creates a data visualization in the form of a histogram regarding contributions to the federal election cycle of 2011-2012. Here, the histogram presents 11 bins ranging from $0 of monetary contributions to $5000. The key of this visualization is to allow the user to explore the number of different values of the contributions made by political entities. The different political entities include contributions made by a candidate, a candidate committee, committee, individual, organization, politial action committee or a party organization. One example can be to explore the different number of contributions made by CCM's, or candidate commitees, where contributions of about $1000 were the most common. The data used in the visualization stems from the Federal Election Committee (FEC), whose statute limits the sources and amounts of the contributions used to finance federal elections and requires public disclosure of campaign finance information. This type of analysis is useful in helping regulate and predict what values are expected/common from a specific entity. This can assist if there is an unprecedented or extreme dip or spike in the average monetary contribution, where the FEC can then investigate if necessary.


## New Information--------------------------------------
A political action committee (PAC) is a type of organization that pools campaign contributions from members and donates those funds to campaign for or against candidates, ballot initiatives, or legislation.


Common transaction types

24K
Contribution made to nonaffiliated committee

24A
Independent expenditure opposing election of candidate

24Z
In-kind contribution made to registered filer
## ----------------------------------------------------

